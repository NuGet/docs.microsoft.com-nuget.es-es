---
title: Restauración de paquetes NuGet
description: Descripción de la manera en que NuGet restaura los paquetes de los que depende un proyecto, incluida la forma de deshabilitar la restauración y la restricción de versiones.
author: karann-msft
ms.author: karann
ms.date: 08/05/2019
ms.topic: conceptual
ms.openlocfilehash: 93a94a5468b48179d27b89825cebf2447657c8f2
ms.sourcegitcommit: 7c9f157ba02d9be543de34ab06813ab1ec10192a
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 08/23/2019
ms.locfileid: "69999983"
---
# <a name="restore-packages-using-package-restore"></a><span data-ttu-id="6f4b1-103">Restauración de paquetes</span><span class="sxs-lookup"><span data-stu-id="6f4b1-103">Restore packages using Package Restore</span></span>

<span data-ttu-id="6f4b1-104">Para promover un entorno de desarrollo más limpio y reducir el tamaño del repositorio, la **Restauración de paquetes** NuGet instala todas las dependencias del proyecto que aparecen en el archivo de proyecto o en `packages.config`.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-104">To promote a cleaner development environment and to reduce repository size, NuGet **Package Restore** installs all of a project's dependencies listed in either the project file or `packages.config`.</span></span> <span data-ttu-id="6f4b1-105">Los comandos `dotnet build` y `dotnet run` de .NET Core 2.0 y versiones posteriores llevan a cabo una restauración de paquetes automática.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-105">The .NET Core 2.0+ `dotnet build` and `dotnet run` commands do an automatic package restore.</span></span> <span data-ttu-id="6f4b1-106">Visual Studio puede restaurar los paquetes automáticamente cuando compila un proyecto, de modo que usted puede restaurar los paquetes en cualquier momento a través de Visual Studio, `nuget restore`, `dotnet restore` y xbuild en Mono.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-106">Visual Studio can restore packages automatically when it builds a project, and you can restore packages at any time through Visual Studio, `nuget restore`, `dotnet restore`, and xbuild on Mono.</span></span>

<span data-ttu-id="6f4b1-107">La Restauración de paquetes garantiza que todas las dependencias de un proyecto estén disponibles sin necesidad de almacenarlas en el código fuente.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-107">Package Restore makes sure that all a project's dependencies are available, without having to store them in source control.</span></span> <span data-ttu-id="6f4b1-108">Si quiere configurar el repositorio de control de código fuente para excluir los archivos binarios del paquete, vea el artículo sobre los [paquetes y el control de código fuente](../consume-packages/packages-and-source-control.md).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-108">To configure your source control repository to exclude the package binaries, see [Packages and source control](../consume-packages/packages-and-source-control.md).</span></span> 

## <a name="package-restore-overview"></a><span data-ttu-id="6f4b1-109">Información general sobre la restauración de paquetes</span><span class="sxs-lookup"><span data-stu-id="6f4b1-109">Package Restore overview</span></span>

<span data-ttu-id="6f4b1-110">La Restauración de paquetes primero instala las dependencias directas de un proyecto según sea necesario y, luego, instala todas las dependencias de los paquetes a lo largo del gráfico de dependencias completo.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-110">Package Restore first installs the direct dependencies of a project as needed, then installs any dependencies of those packages throughout the entire dependency graph.</span></span>

<span data-ttu-id="6f4b1-111">Si un paquete todavía no está instalado, NuGet primero intenta recuperarlo de la [caché](../consume-packages/managing-the-global-packages-and-cache-folders.md).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-111">If a package isn't already installed, NuGet first attempts to retrieve it from the [cache](../consume-packages/managing-the-global-packages-and-cache-folders.md).</span></span> <span data-ttu-id="6f4b1-112">Si el paquete no está en la caché, NuGet intenta descargarlo de todos los orígenes habilitados en la lista de **Herramientas** > **Opciones** > **Administrador de paquetes NuGet**  > **Orígenes de paquetes** en Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-112">If the package isn't in the cache, NuGet tries to download the package from all enabled sources in the list at **Tools** > **Options** > **NuGet Package Manager** > **Package Sources** in Visual Studio.</span></span> <span data-ttu-id="6f4b1-113">Durante la restauración, NuGet omite el orden de los orígenes de paquetes y usa el paquete del origen que primero responda a las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-113">During restore, NuGet ignores the order of package sources, and uses the package from whichever source is first to respond to requests.</span></span> <span data-ttu-id="6f4b1-114">Para obtener más información sobre el comportamiento de NuGet, consulte las [configuraciones comunes de NuGet](Configuring-NuGet-Behavior.md).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-114">For more information about how NuGet behaves, see [Common NuGet configurations](Configuring-NuGet-Behavior.md).</span></span> 

> [!Note]
> <span data-ttu-id="6f4b1-115">NuGet no indica un error al restaurar un paquete hasta que se han comprobado todos los orígenes.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-115">NuGet doesn't indicate a failure to restore a package until all the sources have been checked.</span></span> <span data-ttu-id="6f4b1-116">En ese momento, NuGet solo informa del error del último origen de la lista.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-116">At that time, NuGet reports a failure for only the last source in the list.</span></span> <span data-ttu-id="6f4b1-117">El error implica que el paquete no estaba presente en *ninguno* de los demás orígenes, aunque los errores no se muestran para cada uno de esos orígenes de forma individual.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-117">The error implies that the package wasn't present on *any* of the other sources, even though errors aren't shown for each of those sources individually.</span></span>

## <a name="restore-packages"></a><span data-ttu-id="6f4b1-118">Restaurar paquetes</span><span class="sxs-lookup"><span data-stu-id="6f4b1-118">Restore packages</span></span>

<span data-ttu-id="6f4b1-119">La restauración de paquetes intenta instalar todas las dependencias de paquete en el estado correcto que coincida con las referencias del paquete en el archivo de proyecto ( *.csproj*) o el archivo *packages.config*.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-119">Package Restore tries to install all package dependencies to the correct state matching the package references in your project file (*.csproj*) or your *packages.config* file.</span></span> <span data-ttu-id="6f4b1-120">(En Visual Studio, las referencias aparecen en Explorador de soluciones en el nodo**Dependencias \ NuGet** o **Referencias**).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-120">(In Visual Studio, the references appear in Solution Explorer under the **Dependencies \ NuGet** or the **References** node.)</span></span>

1. <span data-ttu-id="6f4b1-121">Si las referencias del paquete en el archivo del proyecto son correctas, use la herramienta que prefiera para restaurar los paquetes.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-121">If the package references in your project file are correct, use your preferred tool to restore packages.</span></span>

   - <span data-ttu-id="6f4b1-122">[Visual Studio](#restore-using-visual-studio) ([restauración automática](#restore-packages-automatically-using-visual-studio) o [restauración manual](#restore-packages-manually-using-visual-studio))</span><span class="sxs-lookup"><span data-stu-id="6f4b1-122">[Visual Studio](#restore-using-visual-studio) ([automatic restore](#restore-packages-automatically-using-visual-studio) or [manual restore](#restore-packages-manually-using-visual-studio))</span></span>
   - [<span data-ttu-id="6f4b1-123">CLI de dotnet</span><span class="sxs-lookup"><span data-stu-id="6f4b1-123">dotnet CLI</span></span>](#restore-using-the-dotnet-cli)
   - [<span data-ttu-id="6f4b1-124">CLI de nuget.exe</span><span class="sxs-lookup"><span data-stu-id="6f4b1-124">nuget.exe CLI</span></span>](#restore-using-the-nugetexe-cli)
   - [<span data-ttu-id="6f4b1-125">MSBuild</span><span class="sxs-lookup"><span data-stu-id="6f4b1-125">MSBuild</span></span>](#restore-using-msbuild)
   - [<span data-ttu-id="6f4b1-126">Azure Pipelines</span><span class="sxs-lookup"><span data-stu-id="6f4b1-126">Azure Pipelines</span></span>](#restore-using-azure-pipelines)
   - [<span data-ttu-id="6f4b1-127">Azure DevOps Server</span><span class="sxs-lookup"><span data-stu-id="6f4b1-127">Azure DevOps Server</span></span>](#restore-using-azure-devops-server)

   <span data-ttu-id="6f4b1-128">Si las referencias del paquete en el archivo de proyecto ( *.csproj*) o el archivo *packages.config* son incorrectos (no coinciden con el estado deseado después de la restauración de paquetes), debe instalar o actualizar los paquetes en su lugar.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-128">If the package references in your project file (*.csproj*) or your *packages.config* file are incorrect (they do not match your desired state following Package Restore), then you need to either install or update packages instead.</span></span>

   <span data-ttu-id="6f4b1-129">En el caso de los proyectos que usan PackageReference, después de una restauración correcta, el paquete debe estar presente en la carpeta *global-packages* y el archivo `obj/project.assets.json` se vuelve a crear.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-129">For projects using PackageReference, after a successful restore, the package should be present in the *global-packages* folder and the `obj/project.assets.json` file is recreated.</span></span> <span data-ttu-id="6f4b1-130">En el caso de los proyectos que usan `packages.config`, el paquete debe aparecer en la carpeta del proyecto `packages`.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-130">For projects using `packages.config`, the package should appear in the project's `packages` folder.</span></span> <span data-ttu-id="6f4b1-131">Ahora el proyecto debería compilarse correctamente.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-131">The project should now build successfully.</span></span> 

2. <span data-ttu-id="6f4b1-132">Tras ejecutar la restauración de paquetes, si sigue teniendo errores relacionados con los paquetes (como iconos de error en el Explorador de soluciones de Visual Studio) o faltan paquetes, es posible que deba seguir las instrucciones descritas en [Solución de errores de restauración de paquetes](package-restore-troubleshooting.md). Si lo prefiere, puede [reinstalar y actualizar los paquetes](../consume-packages/reinstalling-and-updating-packages.md).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-132">After running Package Restore, if you still experience missing packages or package-related errors (such as error icons in Solution Explorer in Visual Studio), you may need to follow instructions described in [Troubleshooting Package Restore errors](package-restore-troubleshooting.md) or, alternatively, [reinstall and update packages](../consume-packages/reinstalling-and-updating-packages.md).</span></span>

   <span data-ttu-id="6f4b1-133">En Visual Studio, la consola del administrador de paquetes proporciona varias opciones flexibles para volver a instalar los paquetes.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-133">In Visual Studio, the Package Manager Console provides several flexible options for reinstalling packages.</span></span> <span data-ttu-id="6f4b1-134">Consulte [Uso de Package-Update](reinstalling-and-updating-packages.md#using-update-package).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-134">See [Using Package-Update](reinstalling-and-updating-packages.md#using-update-package).</span></span>

## <a name="restore-using-visual-studio"></a><span data-ttu-id="6f4b1-135">Restauración con Visual Studio</span><span class="sxs-lookup"><span data-stu-id="6f4b1-135">Restore using Visual Studio</span></span>

<span data-ttu-id="6f4b1-136">En Visual Studio en Windows, o bien:</span><span class="sxs-lookup"><span data-stu-id="6f4b1-136">In Visual Studio on Windows, either:</span></span>

- <span data-ttu-id="6f4b1-137">Restaure los paquetes de forma automática, o bien</span><span class="sxs-lookup"><span data-stu-id="6f4b1-137">Restore packages automatically, or</span></span>

- <span data-ttu-id="6f4b1-138">Restaure los paquetes de forma manual</span><span class="sxs-lookup"><span data-stu-id="6f4b1-138">Restore packages manually</span></span>

### <a name="restore-packages-automatically-using-visual-studio"></a><span data-ttu-id="6f4b1-139">Restauración automática de paquetes con Visual Studio</span><span class="sxs-lookup"><span data-stu-id="6f4b1-139">Restore packages automatically using Visual Studio</span></span>

<span data-ttu-id="6f4b1-140">La restauración de paquetes se produce automáticamente al crear un proyecto a partir de una plantilla o al compilar un proyecto, según las opciones indicadas en [Habilitación y deshabilitación de la restauración de paquetes](#enable-and-disable-package-restore-in-visual-studio).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-140">Package Restore happens automatically when you create a project from a template or build a project, subject to the options in [Enable and disable package restore](#enable-and-disable-package-restore-in-visual-studio).</span></span> <span data-ttu-id="6f4b1-141">En NuGet 4.0 y versiones posteriores, la restauración también se produce automáticamente al realizar cambios en un proyecto del estilo de SDK (normalmente un proyecto .NET Core o .NET Standard).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-141">In NuGet 4.0+, restore also happens automatically when you make changes to a SDK-style project (typically a .NET Core or .NET Standard project).</span></span>

1. <span data-ttu-id="6f4b1-142">Habilite la restauración automática de paquetes ; para ello, elija **Herramientas** > **Opciones** > **Administrador de paquetes NuGet** y, a continuación, seleccione **Comprobar automáticamente los paquetes que faltan durante la compilación en Visual Studio** en **Restauración de paquetes**.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-142">Enable automatic package restore by choosing **Tools** > **Options** > **NuGet Package Manager**, and then selecting **Automatically check for missing packages during build in Visual Studio** under **Package Restore**.</span></span>

   <span data-ttu-id="6f4b1-143">En el caso de los proyectos que no son de estilo SDK, primero debe seleccionar **Permitir a NuGet descargar los paquetes que falten** para habilitar la opción de restauración automática.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-143">For non-SDK-style projects, you first need to select **Allow NuGet to download missing packages** to enable the automatic restore option.</span></span>

1. <span data-ttu-id="6f4b1-144">Compile el proyecto.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-144">Build the project.</span></span>

   <span data-ttu-id="6f4b1-145">Si uno o varios paquetes no se instalan correctamente, se mostrará un icono de error en el **Explorador de soluciones**.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-145">If one or more individual packages still aren't installed properly, **Solution Explorer** shows an error icon.</span></span> <span data-ttu-id="6f4b1-146">Haga clic con el botón derecho, seleccione **Administrar paquetes NuGet** y use el **Administrador de paquetes** para desinstalar y reinstalar los paquetes afectados.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-146">Right-click and select **Manage NuGet Packages**, and use **Package Manager** to uninstall and reinstall the affected packages.</span></span> <span data-ttu-id="6f4b1-147">Para obtener más información, consulte [Cómo volver a instalar y actualizar paquetes](../consume-packages/reinstalling-and-updating-packages.md).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-147">For more information, see [Reinstall and update packages](../consume-packages/reinstalling-and-updating-packages.md)</span></span>

   <span data-ttu-id="6f4b1-148">Si ve el error "Este proyecto hace referencia a los paquetes NuGet que faltan en este equipo" o "Uno o varios paquetes de NuGet se deben restaurar, pero no pudieron restaurarse porque no se ha concedido el consentimiento", [habilite la restauración automática](#enable-and-disable-package-restore-in-visual-studio).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-148">If you see the error "This project references NuGet package(s) that are missing on this computer," or "One or more NuGet packages need to be restored but couldn't be because consent has not been granted," [enable automatic restore](#enable-and-disable-package-restore-in-visual-studio).</span></span> <span data-ttu-id="6f4b1-149">Para los proyectos anteriores, consulte también [Migración a la restauración automática de paquetes](#migrate-to-automatic-package-restore-visual-studio).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-149">For older projects, also see [Migrate to automatic package restore](#migrate-to-automatic-package-restore-visual-studio).</span></span> <span data-ttu-id="6f4b1-150">Vea también [Solución de errores de restauración de paquetes](Package-restore-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-150">Also see [Package Restore troubleshooting](Package-restore-troubleshooting.md).</span></span>

### <a name="restore-packages-manually-using-visual-studio"></a><span data-ttu-id="6f4b1-151">Restauración manual de paquetes con Visual Studio</span><span class="sxs-lookup"><span data-stu-id="6f4b1-151">Restore packages manually using Visual Studio</span></span>

1. <span data-ttu-id="6f4b1-152">Habilite la restauración de paquetes; para ello, elija **Herramientas** > **Opciones** > **Administrador de paquetes NuGet**.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-152">Enable package restore by choosing **Tools** > **Options** > **NuGet Package Manager**.</span></span> <span data-ttu-id="6f4b1-153">En las opciones de **Restauración de paquetes**, seleccione **Permitir a NuGet descargar los paquetes que falten**.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-153">Under **Package Restore** options, select **Allow NuGet to download missing packages**.</span></span>

1. <span data-ttu-id="6f4b1-154">En el **Explorador de soluciones** haga clic con el botón derecho en la solución y seleccione **Restaurar paquetes NuGet**.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-154">In **Solution Explorer**, right click the solution and select **Restore NuGet Packages**.</span></span>

   <span data-ttu-id="6f4b1-155">Si uno o varios paquetes no se instalan correctamente, se mostrará un icono de error en el **Explorador de soluciones**.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-155">If one or more individual packages still aren't installed properly, **Solution Explorer** shows an error icon.</span></span> <span data-ttu-id="6f4b1-156">Haga clic con el botón derecho, seleccione **Administrar paquetes NuGet** y use el **Administrador de paquetes** para desinstalar y reinstalar los paquetes afectados.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-156">Right-click and select **Manage NuGet Packages**, and then use **Package Manager** to uninstall and reinstall the affected packages.</span></span> <span data-ttu-id="6f4b1-157">Para obtener más información, consulte [Cómo volver a instalar y actualizar paquetes](../consume-packages/reinstalling-and-updating-packages.md).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-157">For more information, see [Reinstall and update packages](../consume-packages/reinstalling-and-updating-packages.md)</span></span>

   <span data-ttu-id="6f4b1-158">Si ve el error "Este proyecto hace referencia a los paquetes NuGet que faltan en este equipo" o "Uno o varios paquetes de NuGet se deben restaurar, pero no pudieron restaurarse porque no se ha concedido el consentimiento", [habilite la restauración automática](#enable-and-disable-package-restore-in-visual-studio).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-158">If you see the error "This project references NuGet package(s) that are missing on this computer," or "One or more NuGet packages need to be restored but couldn't be because consent has not been granted," [enable automatic restore](#enable-and-disable-package-restore-in-visual-studio).</span></span> <span data-ttu-id="6f4b1-159">Para los proyectos anteriores, consulte también [Migración a la restauración automática de paquetes](#migrate-to-automatic-package-restore-visual-studio).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-159">For older projects, also see [Migrate to automatic package restore](#migrate-to-automatic-package-restore-visual-studio).</span></span> <span data-ttu-id="6f4b1-160">Vea también [Solución de errores de restauración de paquetes](Package-restore-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-160">Also see [Package Restore troubleshooting](Package-restore-troubleshooting.md).</span></span>

### <a name="enable-and-disable-package-restore-in-visual-studio"></a><span data-ttu-id="6f4b1-161">Habilitación y deshabilitación de la restauración de paquetes en Visual Studio</span><span class="sxs-lookup"><span data-stu-id="6f4b1-161">Enable and disable package restore in Visual Studio</span></span>

<span data-ttu-id="6f4b1-162">En Visual Studio, la Restauración de paquetes se controla principalmente a través de **Herramientas** > **Opciones** > **Administrador de paquetes NuGet**:</span><span class="sxs-lookup"><span data-stu-id="6f4b1-162">In Visual Studio, you control Package Restore primarily through **Tools** > **Options** > **NuGet Package Manager**:</span></span>

![Control de la Restauración de paquetes a través de las opciones del Administrador de paquetes NuGet](media/Restore-01-AutoRestoreOptions.png)

- <span data-ttu-id="6f4b1-164">**Permitir a NuGet descargar los paquetes que falten** controla todas las formas de restauración de paquetes mediante la modificación de la opción `packageRestore/enabled` en la [sección packageRestore](../reference/nuget-config-file.md#packagerestore-section) del archivo `NuGet.Config`, en `%AppData%\NuGet\` en Windows y en `~/.nuget/NuGet/` en Mac/Linux.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-164">**Allow NuGet to download missing packages** controls all forms of package restore by changing the `packageRestore/enabled` setting in the [packageRestore section](../reference/nuget-config-file.md#packagerestore-section) of the `NuGet.Config` file, at `%AppData%\NuGet\` on Windows, or `~/.nuget/NuGet/` on Mac/Linux.</span></span> <span data-ttu-id="6f4b1-165">Esta opción también habilita el comando **Restaurar paquetes NuGet** en el menú contextual de la solución en Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-165">This setting also enables the **Restore NuGet Packages** command on the solution's context menu in Visual Studio, .</span></span>

    ```xml
    <configuration>
        <packageRestore>
            <!-- The 'enabled' key is True when the "Allow NuGet to download missing packages" checkbox is set.
                 Clearing the box sets this to False, disabling command-line, automatic, and MSBuild-integrated restore. -->
            <add key="enabled" value="True" />
        </packageRestore>
    </configuration>
    ```
    
  > [!Note]
  > <span data-ttu-id="6f4b1-166">Para invalidar de forma global la opción `packageRestore/enabled`, establezca la variable de entorno **EnableNuGetPackageRestore** con un valor de True o False antes de iniciar Visual Studio o una compilación.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-166">To globally override the `packageRestore/enabled` setting, set the environment variable **EnableNuGetPackageRestore** with a value of True or False before launching Visual Studio or starting a build.</span></span>

- <span data-ttu-id="6f4b1-167">**Comprobar automáticamente los paquetes que falten durante la compilación en Visual Studio** controla la restauración automática mediante la modificación del ajuste `packageRestore/automatic` en la [sección packageRestore](../reference/nuget-config-file.md#packagerestore-section) del archivo `NuGet.Config`.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-167">**Automatically check for missing packages during build in Visual Studio** controls automatic restore by changing the `packageRestore/automatic` setting in the [packageRestore section](../reference/nuget-config-file.md#packagerestore-section) of the `NuGet.Config` file.</span></span> <span data-ttu-id="6f4b1-168">Cuando esta opción se establece en True, al ejecutar una compilación de Visual Studio se restauran automáticamente todos los paquetes que falten.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-168">When this option is set to True, running a build from Visual Studio automatically restores any missing packages.</span></span> <span data-ttu-id="6f4b1-169">Esta configuración no afecta a las compilaciones que se ejecutan desde la línea de comandos de MSBuild.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-169">This setting doesn't affect builds run from the MSBuild command line.</span></span>

    ```xml
    ...
    <configuration>
        <packageRestore>
            <!-- The 'automatic' key is set to True when the "Automatically check for missing packages during
                 build in Visual Studio" checkbox is set. Clearing the box sets this to False and disables
                 automatic restore. -->
            <add key="automatic" value="True" />
        </packageRestore>
    </configuration>
    ```

<span data-ttu-id="6f4b1-170">Para habilitar o deshabilitar la Restauración de paquetes para todos los usuarios de un equipo, un desarrollador o una empresa pueden agregar los valores de configuración al archivo global `nuget.config`.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-170">To enable or disable Package Restore for all users on a computer, a developer or company can add the configuration settings to the global `nuget.config` file.</span></span> <span data-ttu-id="6f4b1-171">El archivo global `nuget.config` se encuentra en Windows en `%ProgramData%\NuGet\Config`, a veces en una carpeta `\{IDE}\{Version}\{SKU}\` determinada de Visual Studio, o en Mac/Linux en `~/.local/share`.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-171">The global `nuget.config` is in Windows at `%ProgramData%\NuGet\Config`, sometimes under a specific `\{IDE}\{Version}\{SKU}\` Visual Studio folder, or in Mac/Linux at `~/.local/share`.</span></span> <span data-ttu-id="6f4b1-172">Después, los usuarios individuales pueden habilitar la restauración de forma selectiva cuando sea necesario en un nivel de proyecto.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-172">Individual users can then selectively enable restore as needed on a project level.</span></span> <span data-ttu-id="6f4b1-173">Para obtener más información sobre la manera en que NuGet prioriza varios archivos de configuración, consulte las [configuraciones comunes de NuGet](../consume-packages/configuring-nuget-behavior.md#how-settings-are-applied).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-173">For more details on how NuGet prioritizes multiple config files, see [Common NuGet configurations](../consume-packages/configuring-nuget-behavior.md#how-settings-are-applied).</span></span>

> [!Important]
> <span data-ttu-id="6f4b1-174">Si edita el valor `packageRestore` directamente en `nuget.config`, debe reiniciar Visual Studio para que en el cuadro de diálogo **Opciones** se muestren los valores actuales.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-174">If you edit the `packageRestore` settings directly in `nuget.config`, restart Visual Studio, so that the **Options** dialog box shows the current values.</span></span>

## <a name="restore-using-the-dotnet-cli"></a><span data-ttu-id="6f4b1-175">Restauración mediante la CLI de dotnet</span><span class="sxs-lookup"><span data-stu-id="6f4b1-175">Restore using the dotnet CLI</span></span>

[!INCLUDE [restore-dotnet-cli](includes/restore-dotnet-cli.md)]

> [!IMPORTANT]
> <span data-ttu-id="6f4b1-176">Para agregar una referencia de paquete que falta al archivo del proyecto, use [dotnet add package](/dotnet/core/tools/dotnet-add-package?tabs=netcore2x), que también ejecuta el comando `restore`.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-176">To add a missing package reference to the project file, use [dotnet add package](/dotnet/core/tools/dotnet-add-package?tabs=netcore2x), which also runs the `restore` command.</span></span>

## <a name="restore-using-the-nugetexe-cli"></a><span data-ttu-id="6f4b1-177">Restauración con la CLI de nuget.exe</span><span class="sxs-lookup"><span data-stu-id="6f4b1-177">Restore using the nuget.exe CLI</span></span>

[!INCLUDE [restore-nuget-exe-cli](includes/restore-nuget-exe-cli.md)]

> [!IMPORTANT]
> <span data-ttu-id="6f4b1-178">El comando `restore`no modifica un archivo del proyecto o *packages.config*. Para agregar una dependencia, puede agregar un paquete mediante la interfaz de usuario del Administrador de paquetes o la consola en Visual Studio, o bien modificar *packages.config* y, luego, ejecutar `install` o `restore`.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-178">The `restore`command does not modify a project file or *packages.config*. To add a dependency, either add a package through the Package Manager UI or Console in Visual Studio, or modify *packages.config* and then run either `install` or `restore`.</span></span>

## <a name="restore-using-msbuild"></a><span data-ttu-id="6f4b1-179">Restauración con MSBuild</span><span class="sxs-lookup"><span data-stu-id="6f4b1-179">Restore using MSBuild</span></span>

<span data-ttu-id="6f4b1-180">Para restaurar los paquetes mostrados en el archivo del proyecto con PackageReference, utilice el comando [msbuild -t:restore](../reference/msbuild-targets.md#restore-target).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-180">To restore packages listed in the project file with PackageReference, use the the [msbuild -t:restore](../reference/msbuild-targets.md#restore-target) command.</span></span> <span data-ttu-id="6f4b1-181">Este comando está disponible solo en NuGet 4.x y versiones posteriores y en MSBuild 15.1 y versiones posteriores, que se incluyen con Visual Studio 2017 y versiones posteriores.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-181">This command is available only in NuGet 4.x+ and MSBuild 15.1+, which are included with Visual Studio 2017 and higher versions.</span></span> <span data-ttu-id="6f4b1-182">Tanto `nuget restore` como `dotnet restore` usan este comando para los proyectos aplicables.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-182">Both `nuget restore` and `dotnet restore` use this command for applicable projects.</span></span>

1. <span data-ttu-id="6f4b1-183">Abra un símbolo del sistema para desarrolladores (en el cuadro **Búsqueda**, escriba **Símbolo del sistema para desarrolladores**).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-183">Open a Developer command prompt (In the **Search** box, type **Developer command prompt**).</span></span>

   <span data-ttu-id="6f4b1-184">Normalmente, es preferible iniciar el símbolo del sistema para desarrolladores de Visual Studio en el menú **Inicio**, ya que se configurará con todas las rutas de acceso necesarias para MSBuild.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-184">You typically want to start the Developer Command Prompt for Visual Studio from the **Start** menu, as it will be configured with all the necessary paths for MSBuild.</span></span>

2. <span data-ttu-id="6f4b1-185">Cambie a la carpeta que contiene el archivo del proyecto y escriba el siguiente comando.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-185">Switch to the folder containing the project file and type the following command.</span></span>

   ```cmd
   # Uses the project file in the current folder by default
   msbuild -t:restore
   ```

3. <span data-ttu-id="6f4b1-186">Escriba el siguiente comando para recompilar el proyecto.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-186">Type the following command to rebuild the project.</span></span>

   ```cmd
   msbuild
   ```

   <span data-ttu-id="6f4b1-187">Asegúrese de que la salida de MSBuild indica que la compilación se ha completado correctamente.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-187">Make sure that the MSBuild output indicates that the build completed successfully.</span></span>

## <a name="restore-using-azure-pipelines"></a><span data-ttu-id="6f4b1-188">Restauración con Azure Pipelines</span><span class="sxs-lookup"><span data-stu-id="6f4b1-188">Restore using Azure Pipelines</span></span>

<span data-ttu-id="6f4b1-189">al crear una definición de compilación en Azure Pipelines, incluya la tarea [restore](/azure/devops/pipelines/tasks/package/nuget#restore-nuget-packages) de NuGet o [restore](/azure/devops/pipelines/tasks/build/dotnet-core-cli?view=azure-devops) de .NET Core en la definición antes de cualquier tarea de compilación.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-189">When you create a build definition in Azure Pipelines, include the NuGet [restore](/azure/devops/pipelines/tasks/package/nuget#restore-nuget-packages) or .NET Core [restore](/azure/devops/pipelines/tasks/build/dotnet-core-cli?view=azure-devops) task in the definition before any build tasks.</span></span> <span data-ttu-id="6f4b1-190">Algunas plantillas de compilación incluyen la tarea restore de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-190">Some build templates include the restore task by default.</span></span>

## <a name="restore-using-azure-devops-server"></a><span data-ttu-id="6f4b1-191">Restauración con Azure DevOps Server</span><span class="sxs-lookup"><span data-stu-id="6f4b1-191">Restore using Azure DevOps Server</span></span>

<span data-ttu-id="6f4b1-192">tanto Azure DevOps Server como TFS 2013 y versiones posteriores restauran los paquetes automáticamente durante la compilación, siempre y cuando use una plantilla de Team Build para TFS 2013 o versiones posteriores.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-192">Azure DevOps Server and TFS 2013 and later automatically restore packages during build, if you're using a TFS 2013 or later Team Build template.</span></span> <span data-ttu-id="6f4b1-193">En el caso de versiones anteriores de TFS, puede incluir un paso de compilación para ejecutar una opción de restauración de la línea de comandos, o bien migrar la plantilla de compilación a una versión posterior.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-193">For earlier TFS versions, you can include a build step to run a command-line restore option, or optionally migrate the build template to a later version.</span></span> <span data-ttu-id="6f4b1-194">Para obtener más información, consulte [Configurar la restauración de paquetes con Team Foundation Build](../consume-packages/team-foundation-build.md).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-194">For more information, see [Set up package restore with Team Foundation Build](../consume-packages/team-foundation-build.md).</span></span>

## <a name="constrain-package-versions-with-restore"></a><span data-ttu-id="6f4b1-195">Restricción de versiones de paquetes con la restauración</span><span class="sxs-lookup"><span data-stu-id="6f4b1-195">Constrain package versions with restore</span></span>

<span data-ttu-id="6f4b1-196">Cuando NuGet restaure paquetes con cualquier método, respetará las restricciones que haya especificado en `packages.config` o en el archivo de proyecto:</span><span class="sxs-lookup"><span data-stu-id="6f4b1-196">When NuGet restores packages through any method, it honors any constraints you specified in `packages.config` or the project file:</span></span>

- <span data-ttu-id="6f4b1-197">En `packages.config`, puede especificar un intervalo de versiones en la propiedad `allowedVersion` de la dependencia.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-197">In `packages.config`, you can specify a version range in the `allowedVersion` property of the dependency.</span></span> <span data-ttu-id="6f4b1-198">Consulte [Restringir las versiones de actualización](../consume-packages/reinstalling-and-updating-packages.md#constraining-upgrade-versions) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-198">See [Constrain upgrade versions](../consume-packages/reinstalling-and-updating-packages.md#constraining-upgrade-versions) for more information.</span></span> <span data-ttu-id="6f4b1-199">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="6f4b1-199">For example:</span></span>

    ```xml
    <package id="Newtonsoft.json" version="6.0.4" allowedVersions="[6,7)" />
    ```

- <span data-ttu-id="6f4b1-200">En un archivo de proyecto, puede usar PackageReference para especificar directamente el intervalo de una dependencia.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-200">In a project file, you can use PackageReference to specify a dependency's range directly.</span></span> <span data-ttu-id="6f4b1-201">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="6f4b1-201">For example:</span></span>

    ```xml
    <PackageReference Include="Newtonsoft.json" Version="[6, 7)" />
    ```

<span data-ttu-id="6f4b1-202">En todos los casos, use la notación que se describe en [Package versioning](../concepts/package-versioning.md) (Control de versiones de paquetes).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-202">In all cases, use the notation described in [Package versioning](../concepts/package-versioning.md).</span></span>

## <a name="force-restore-from-package-sources"></a><span data-ttu-id="6f4b1-203">Restauración forzada a partir de orígenes de paquetes</span><span class="sxs-lookup"><span data-stu-id="6f4b1-203">Force restore from package sources</span></span>

<span data-ttu-id="6f4b1-204">De forma predeterminada, las operaciones de restauración de NuGet usan paquetes de las carpetas *global-packages* y *http-cache*, que se describen en [Administración de las carpetas de paquetes globales, de caché y temporales](managing-the-global-packages-and-cache-folders.md).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-204">By default, NuGet restore operations use packages from the *global-packages* and *http-cache* folders, which are described in [Manage the global packages and cache folders](managing-the-global-packages-and-cache-folders.md).</span></span>

<span data-ttu-id="6f4b1-205">Para evitar el uso de la carpeta *global-packages*, realice una de las siguientes acciones:</span><span class="sxs-lookup"><span data-stu-id="6f4b1-205">To avoid using the *global-packages* folder, do one of the following:</span></span>

- <span data-ttu-id="6f4b1-206">Borre la carpeta con `nuget locals global-packages -clear` o `dotnet nuget locals global-packages --clear`.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-206">Clear the folder using `nuget locals global-packages -clear` or `dotnet nuget locals global-packages --clear`.</span></span>
- <span data-ttu-id="6f4b1-207">Cambie temporalmente la ubicación de la carpeta *global-packages* antes de la operación de restauración con uno de los métodos siguientes:</span><span class="sxs-lookup"><span data-stu-id="6f4b1-207">Temporarily change the location of the *global-packages* folder before the restore operation, using one of the following methods:</span></span>
  - <span data-ttu-id="6f4b1-208">Establezca la variable de entorno NUGET_PACKAGES en otra carpeta.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-208">Set the NUGET_PACKAGES environment variable to a different folder.</span></span>
  - <span data-ttu-id="6f4b1-209">Cree un archivo `NuGet.Config` que establezca `globalPackagesFolder` (si usa PackageReference) o `repositoryPath` (si usa `packages.config`) en otra carpeta.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-209">Create a `NuGet.Config` file that sets `globalPackagesFolder` (if using PackageReference) or `repositoryPath` (if using `packages.config`) to a different folder.</span></span> <span data-ttu-id="6f4b1-210">Para obtener más información, vea los [valores de configuración](../reference/nuget-config-file.md#config-section).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-210">For more information, see [configuration settings](../reference/nuget-config-file.md#config-section).</span></span>
  - <span data-ttu-id="6f4b1-211">Solo MSBuild: especifique otra carpeta con la propiedad `RestorePackagesPath`.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-211">MSBuild only: Specify a different folder with the `RestorePackagesPath` property.</span></span>

<span data-ttu-id="6f4b1-212">Para evitar el uso de la memoria caché para los orígenes HTTP, realice una de las siguientes acciones:</span><span class="sxs-lookup"><span data-stu-id="6f4b1-212">To avoid using the cache for HTTP sources, do one of the following:</span></span>

- <span data-ttu-id="6f4b1-213">Use la opción `-NoCache` con `nuget restore`, o bien la opción `--no-cache` con `dotnet restore`.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-213">Use the `-NoCache` option with `nuget restore`, or the `--no-cache` option with `dotnet restore`.</span></span> <span data-ttu-id="6f4b1-214">Estas opciones no afectan a las operaciones de restauración mediante la consola o el Administrador de paquetes de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-214">These options don't affect restore operations through the Visual Studio Package Manager or console.</span></span>
- <span data-ttu-id="6f4b1-215">Borre la memoria caché con `nuget locals http-cache -clear` o `dotnet nuget locals http-cache --clear`.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-215">Clear the cache using `nuget locals http-cache -clear` or `dotnet nuget locals http-cache --clear`.</span></span>
- <span data-ttu-id="6f4b1-216">Establezca temporalmente la variable de entorno NUGET_HTTP_CACHE_PATH en otra carpeta.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-216">Temporarily set the NUGET_HTTP_CACHE_PATH environment variable to a different folder.</span></span>

## <a name="migrate-to-automatic-package-restore-visual-studio"></a><span data-ttu-id="6f4b1-217">Migración a la restauración automática de paquetes (Visual Studio)</span><span class="sxs-lookup"><span data-stu-id="6f4b1-217">Migrate to automatic package restore (Visual Studio)</span></span>

<span data-ttu-id="6f4b1-218">En NuGet 2.6 y versiones anteriores se permitía una restauración de paquetes integrada en MSBuild, pero eso ya no es así.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-218">For NuGet 2.6 and earlier, an MSBuild-integrated package restore was previously supported but that is no longer true.</span></span> <span data-ttu-id="6f4b1-219">(Normalmente se habilitaba haciendo clic con el botón derecho en una solución en Visual Studio y seleccionando **Habilitar restauración de paquetes NuGet**).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-219">(It was typically enabled by right-clicking a solution in Visual Studio and selecting **Enable NuGet Package Restore**).</span></span> <span data-ttu-id="6f4b1-220">Si el proyecto usa la restauración de paquetes integrada en MSBuild en desuso, migre a la restauración automática de paquetes.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-220">If your project uses the deprecated MSBuild-integrated package restore, please migrate to automatic package restore.</span></span>

<span data-ttu-id="6f4b1-221">Los proyectos que usan la restauración de paquetes integrada en MSBuild normalmente contienen una carpeta *.nuget* con tres archivos: *NuGet.config*, *nuget.exe* y *NuGet.targets*.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-221">Projects that use MSBuild-Integrated package restore typically contain a *.nuget* folder with three files: *NuGet.config*, *nuget.exe*, and *NuGet.targets*.</span></span> <span data-ttu-id="6f4b1-222">La presencia de un archivo *NuGet.targets* determina si NuGet seguirá usando el enfoque integrado en MSBuild, por lo que este archivo debe quitarse durante la migración.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-222">The presence of a *NuGet.targets* file determines whether NuGet will continue to use the MSBuild-untegrated approach, so this file must be removed during the migration.</span></span>

<span data-ttu-id="6f4b1-223">Para migrar a la restauración automática de paquetes, realice lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="6f4b1-223">To migrate to automatic package restore:</span></span>

1. <span data-ttu-id="6f4b1-224">Cierre Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-224">Close Visual Studio.</span></span>
2. <span data-ttu-id="6f4b1-225">Elimine los archivos *.nuget/nuget.exe* y *.nuget/NuGet.targets*.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-225">Delete *.nuget/nuget.exe* and *.nuget/NuGet.targets*.</span></span>
3. <span data-ttu-id="6f4b1-226">Para cada archivo del proyecto, quite el elemento `<RestorePackages>` y todas las referencias a *NuGet.targets*.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-226">For each project file, remove the `<RestorePackages>` element and remove any reference to *NuGet.targets*.</span></span>

<span data-ttu-id="6f4b1-227">Para probara la restauración automática de paquetes, realice lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="6f4b1-227">To test the automatic package restore:</span></span>

1. <span data-ttu-id="6f4b1-228">Quite la carpeta *paquetes* de la solución.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-228">Remove the *packages* folder from the solution.</span></span>
2. <span data-ttu-id="6f4b1-229">Abra la solución en Visual Studio e inicie una compilación.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-229">Open the solution in Visual Studio and start a build.</span></span>

   <span data-ttu-id="6f4b1-230">La restauración automática de paquetes debe descargar e instalar los paquetes de dependencia, sin agregarlos al control de código fuente.</span><span class="sxs-lookup"><span data-stu-id="6f4b1-230">Automatic package restore should download and install each dependency package, without adding them to source control.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="6f4b1-231">Solución de problemas</span><span class="sxs-lookup"><span data-stu-id="6f4b1-231">Troubleshooting</span></span>

<span data-ttu-id="6f4b1-232">Vea [Solución de errores de restauración de paquetes](package-restore-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="6f4b1-232">See [Troubleshoot package restore](package-restore-troubleshooting.md).</span></span>
